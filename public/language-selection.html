<!DOCTYPE html>
<html class="light" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Language Selection - Chinese Learning App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#448fe4",
            "background-light": "#f6f7f8",
            "background-dark": "#111921",
            "surface-light": "#ffffff",
            "surface-dark": "#18222c",
            "text-primary-light": "#111417",
            "text-primary-dark": "#f0f4f8",
            "text-secondary-light": "#647487",
            "text-secondary-dark": "#a0aec0",
            "border-light": "#dce0e5",
            "border-dark": "#2d3748",
          },
          fontFamily: {
            "display": ["Work Sans", "sans-serif"]
          },
        },
      },
    }
  </script>
  <style>
    body {
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-smoothing: grayscale;
    }

    .language-option {
      transition: all 0.2s ease;
    }

    .language-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(68, 143, 228, 0.15);
    }

    .language-option input:checked ~ .option-content {
      background: rgba(68, 143, 228, 0.1);
      border-color: #448fe4;
    }

    .language-option input:checked ~ .option-content .check-icon {
      opacity: 1;
    }
  </style>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-text-primary-light dark:text-text-primary-dark">

  <div class="flex min-h-screen flex-col p-6">

    <!-- Header -->
    <div class="mb-12 text-center">
      <div class="mx-auto mb-6 text-6xl">
        üåç
      </div>
      <h1 class="text-2xl font-bold mb-2">Select Language</h1>
      <p class="text-sm text-text-secondary-light dark:text-text-secondary-dark">Choose your interface language</p>
    </div>

    <!-- Language Options -->
    <div class="mx-auto w-full max-w-md space-y-3 flex-1">

      <!-- Uzbek -->
      <label class="language-option block cursor-pointer">
        <input type="radio" name="language" value="uz" class="peer hidden" />
        <div class="option-content relative flex items-center gap-4 rounded-2xl border-2 border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark p-6 shadow-sm transition-all peer-checked:border-primary peer-checked:bg-primary/5">

          <div class="flag-icon flex h-14 w-14 flex-shrink-0 items-center justify-center text-5xl">
            üá∫üáø
          </div>

          <div class="flex-1">
            <p class="text-lg font-bold">O'zbek tili</p>
            <p class="language-subtitle text-sm text-text-secondary-light dark:text-text-secondary-dark transition-colors">Uzbek</p>
          </div>

          <div class="check-icon flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-primary text-white opacity-0 transition-opacity">
            <span class="material-symbols-outlined text-sm">check</span>
          </div>
        </div>
      </label>

      <!-- Russian -->
      <label class="language-option block cursor-pointer">
        <input type="radio" name="language" value="ru" class="peer hidden" />
        <div class="option-content relative flex items-center gap-4 rounded-2xl border-2 border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark p-6 shadow-sm transition-all peer-checked:border-primary peer-checked:bg-primary/5">

          <div class="flag-icon flex h-14 w-14 flex-shrink-0 items-center justify-center text-5xl">
            üá∑üá∫
          </div>

          <div class="flex-1">
            <p class="text-lg font-bold">–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</p>
            <p class="language-subtitle text-sm text-text-secondary-light dark:text-text-secondary-dark transition-colors">Russian</p>
          </div>

          <div class="check-icon flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-primary text-white opacity-0 transition-opacity">
            <span class="material-symbols-outlined text-sm">check</span>
          </div>
        </div>
      </label>

      <!-- English -->
      <label class="language-option block cursor-pointer">
        <input type="radio" name="language" value="en" class="peer hidden" />
        <div class="option-content relative flex items-center gap-4 rounded-2xl border-2 border-border-light dark:border-border-dark bg-surface-light dark:bg-surface-dark p-6 shadow-sm transition-all peer-checked:border-primary peer-checked:bg-primary/5">

          <div class="flag-icon flex h-14 w-14 flex-shrink-0 items-center justify-center text-5xl">
            üá¨üáß
          </div>

          <div class="flex-1">
            <p class="text-lg font-bold">English</p>
            <p class="language-subtitle text-sm text-text-secondary-light dark:text-text-secondary-dark transition-colors">English</p>
          </div>

          <div class="check-icon flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-primary text-white opacity-0 transition-opacity">
            <span class="material-symbols-outlined text-sm">check</span>
          </div>
        </div>
      </label>

    </div>

    <!-- Continue Button (Fixed at bottom) -->
    <div class="sticky bottom-0 mt-8 pb-6">
      <button id="continueBtn" class="flex w-full max-w-md mx-auto items-center justify-center gap-2 rounded-2xl bg-primary px-6 py-4 font-bold text-white shadow-lg transition-all active:scale-98">
        <span>Continue</span>
        <span class="material-symbols-outlined">arrow_forward</span>
      </button>

      <!-- Progress Indicator -->
      <div class="mt-6 flex items-center justify-center gap-2">
        <div class="h-2 w-8 rounded-full bg-primary"></div>
        <div class="h-2 w-8 rounded-full bg-border-light dark:bg-border-dark"></div>
      </div>
    </div>

  </div>

  <script src="/i18n.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    let selectedLanguage = null;
    const continueBtn = document.getElementById('continueBtn');
    const languageInputs = document.querySelectorAll('input[name="language"]');

    // Handle language selection
    languageInputs.forEach(input => {
      input.addEventListener('change', (e) => {
        selectedLanguage = e.target.value;

        // Haptic feedback
        if (tg.HapticFeedback) {
          tg.HapticFeedback.impactOccurred('light');
        }

        // Save to localStorage
        localStorage.setItem('selectedLanguage', selectedLanguage);
        localStorage.setItem('appLanguage', selectedLanguage);

        console.log('Language selected:', selectedLanguage);
      });
    });

    // Handle continue button
    continueBtn.addEventListener('click', () => {
      if (!selectedLanguage) {
        // If no language selected, use first checked radio
        const checkedInput = document.querySelector('input[name="language"]:checked');
        selectedLanguage = checkedInput ? checkedInput.value : 'en';
        localStorage.setItem('selectedLanguage', selectedLanguage);
        localStorage.setItem('appLanguage', selectedLanguage);
      }

      // Haptic feedback
      if (tg.HapticFeedback) {
        tg.HapticFeedback.notificationOccurred('success');
      }

      // Set language in i18n
      if (window.i18n) {
        window.i18n.setLanguage(selectedLanguage);
      }

      // Redirect to level selection
      window.location.href = '/level-select.html';
    });

    // Load previously selected language if exists
    const savedLanguage = localStorage.getItem('selectedLanguage');
    if (savedLanguage) {
      const input = document.querySelector(`input[value="${savedLanguage}"]`);
      if (input) {
        input.checked = true;
        selectedLanguage = savedLanguage;
      }
    }

    // Initialize i18n
    if (window.i18n) {
      window.i18n.init();
    }
  </script>

</body>
</html>
